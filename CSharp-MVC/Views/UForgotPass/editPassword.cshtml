@using Newtonsoft.Json
@model CodeModel
@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<head>
    <link rel="stylesheet" href="~/css/signup.css" asp-append-version="true" />

</head>
@if (ViewBag.SuccessMsg != null)
{
    <div id="msgAlert" class="alert alert-success" role="alert">
        @ViewBag.SuccessMsg
    </div>
}
<body>

    <style>
        .nice-select {
            width: 100%;
        }

        .list {
            width: 100%;
        }

        #countdown {
            font-size: 15px;
            text-decoration: underline;
            text-align: end;
            margin-top: 1%;
            display: none;
        }
    </style>
    <div class="sign-up-background pt-4 pb-4">
        <div class="sign-up-wrapper">
            <div class="sign-up-info mx-auto col-10 col-md-8 col-lg-6">
                <h1>Đổi mật khẩu</h1>
                <form >
                    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                    <div class="justify-content-end">

                        <label class="form-label">Mật khẩu</label>


                        <input id="password" minLength="6" required type="password" class="form-control"></input>

                        <label class="form-label">Nhập lại mật khẩu</label>
                        <input id="passwordrp" minLength="6" required type="password" class="form-control"></input>


                    </div>
                    <div class="" style="width:100%; margin-top:2%; display:flex; justify-content:center">
                        <button type="button" style="width:20%" id="submitButton" class="btn btn-outline-primary">Đổi mật khẩu</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
@section Scripts {
    <script>

        $(document).ready(function () {
            $('#submitButton').click(function () {

                var password = $('#password').val();
                var passwordrp = $('#passwordrp').val();

                var model = @Html.Raw(JsonConvert.SerializeObject(Model));
                var product = {
                    email : model.email,
                    code: model.code,
                    password : password
                }

                var jsonString = JSON.stringify(product);

                console.log(jsonString);
                    $.ajax({
                        url: '/UForgotPass/ChangePassword',
                        type: 'POST',
                        contentType: 'application/json',
                        // dữ liệu đẩy xuống
                        data: jsonString,
                        headers: {
                            'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val()
                        },
                        success: function (response) {
                        if (response.message == "success") {
                                    window.location.href = '/USignin/Index';
                               }else{
                            console.log("Lỗi đổi mk");
                               }
                        },
                        error: function (error) {
                            console.log("error");
                        }


                    });
                



            });
        });

    </script>
}
